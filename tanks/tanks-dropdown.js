const TANKS_JSON = [
  {
    'Category EN': 'Moscow',
    'Category RU': 'Москва',
    Campaign: [
      {
        'Category EN': 'Allies',
        'Category RU': 'Союзники',
        Side: [
          {
            'Name EN': 'BA-11',
            'Name RU': 'БA-11',
            'Name Game': 'ussr_ba_11',
          },
          {
            'Name EN': 'BM-8-24',
            'Name RU': 'БM-8-24',
            'Name Game': 'ussr_bm_8_24',
          },
          {
            'Name EN': 'BT-7',
            'Name RU': 'БT-7',
            'Name Game': 'ussr_bt_7_1937',
          },
          {
            'Name EN': 'M-3 Medium',
            'Name RU': 'M-3 Средний',
            'Name Game': 'us_m3_lee',
          },
          {
            'Name EN': 'T-26',
            'Name RU': 'T-26',
            'Name Game': 'ussr_t_26_1940',
          },
          {
            'Name EN': 'T-28',
            'Name RU': 'T-28',
            'Name Game': 'ussr_t_28',
          },
          {
            'Name EN': 'T-28E',
            'Name RU': 'T-28Э',
            'Name Game': 'ussr_t_28e',
          },
          {
            'Name EN': 'T-34',
            'Name RU': 'T-34',
            'Name Game': 'ussr_t_34_1940_l_11',
          },
          {
            'Name EN': 'T-50',
            'Name RU': 'T-50',
            'Name Game': 'ussr_t_50',
          },
          {
            'Name EN': 'T-60',
            'Name RU': 'T-60',
            'Name Game': 'ussr_t_60_1941',
          },
          {
            'Name EN': 'Valentine',
            'Name RU': 'Valentine',
            'Name Game': 'ussr_valentine_i',
          },
        ],
      },
      {
        'Category EN': 'Axis',
        'Category RU': 'Ось',
        Side: [
          {
            'Name EN': 'Pz.38(t) F',
            'Name RU': 'Pz.38(t) F',
            'Name Game': 'germ_pzkpfw_38t_ausf_f',
          },
          {
            'Name EN': 'Pz.II C',
            'Name RU': 'Pz.II C',
            'Name Game': 'germ_pzkpfw_ii_ausf_c',
          },
          {
            'Name EN': 'Pz.III B',
            'Name RU': 'Pz.III B',
            'Name Game': 'germ_pzkpfw_iii_ausf_b',
          },
          {
            'Name EN': 'Pz.III E',
            'Name RU': 'Pz.III E',
            'Name Game': 'germ_pzkpfw_iii_ausf_e',
          },
          {
            'Name EN': 'Pz.III J',
            'Name RU': 'Pz.III J',
            'Name Game': 'germ_pzkpfw_iii_ausf_j_l42',
          },
          {
            'Name EN': 'Pz.III J1',
            'Name RU': 'Pz.III J1',
            'Name Game': 'germ_pzkpfw_iii_ausf_j1_l60',
          },
          {
            'Name EN': 'Pz.IV E',
            'Name RU': 'Pz.IV E',
            'Name Game': 'germ_pzkpfw_iv_ausf_e',
          },
          {
            'Name EN': 'Pz.IV F1',
            'Name RU': 'Pz.IV F1',
            'Name Game': 'germ_pzkpfw_iv_ausf_f',
          },
        ],
      },
    ],
  },
  {
    'Category EN': 'Normandy',
    'Category RU': 'Нормандия',
    Campaign: [
      {
        'Category EN': 'Allies',
        'Category RU': 'Союзники',
        Side: [
          {
            'Name EN': 'Calliope',
            'Name RU': 'Calliope',
            'Name Game': 'us_m4_calliope',
          },
          {
            'Name EN': 'Churchill III',
            'Name RU': 'Churchill III',
            'Name Game': 'churchill_3',
          },
          {
            'Name EN': 'M4A1 (76) W',
            'Name RU': 'M4A1 (76) W',
            'Name Game': 'us_m4a1_76w_sherman',
          },
          {
            'Name EN': 'M4A2',
            'Name RU': 'M4A2',
            'Name Game': 'us_m4a2_sherman_1944',
          },
          {
            'Name EN': 'M4A3E2 Jumbo',
            'Name RU': 'M4A3E2 Jumbo',
            'Name Game': 'us_m4a3e2_sherman_jumbo',
          },
          {
            'Name EN': 'M5A1',
            'Name RU': 'M5A1',
            'Name Game': 'us_m5a1_stuart_late',
          },
          {
            'Name EN': 'M8 Scott',
            'Name RU': 'M8 Scott',
            'Name Game': 'us_m8_scott',
          },
          {
            'Name EN': 'M10 GMC',
            'Name RU': 'M10 GMC',
            'Name Game': 'us_m10_wolverine',
          },
          {
            'Name EN': 'M24',
            'Name RU': 'M24',
            'Name Game': 'us_m24_chaffee',
          },
          {
            'Name EN': 'Sherman IC "Firefly"',
            'Name RU': 'Sherman IC "Firefly"',
            'Name Game': 'uk_sherman_ic_firefly',
          },
        ],
      },
      {
        'Category EN': 'Axis',
        'Category RU': 'Ось',
        Side: [
          {
            'Name EN': '15 cm Pz. W.42',
            'Name RU': '15 cm Pz. W.42',
            'Name Game': 'germ_panzerwerfer_42',
          },
          {
            'Name EN': 'Panther A',
            'Name RU': 'Panther A',
            'Name Game': 'germ_pzkpfw_v_ausf_a_panther',
          },
          {
            'Name EN': 'Pz.III M',
            'Name RU': 'Pz.III M',
            'Name Game': 'germ_pzkpfw_iii_ausf_m',
          },
          {
            'Name EN': 'Pz.III N',
            'Name RU': 'Pz.III N',
            'Name Game': 'germ_pzkpfw_iii_ausf_n',
          },
          {
            'Name EN': 'Pz.IV H',
            'Name RU': 'Pz.IV H',
            'Name Game': 'germ_pzkpfw_iv_ausf_h',
          },
          {
            'Name EN': 'Pz.IV J',
            'Name RU': 'Pz.IV J',
            'Name Game': 'germ_pzkpfw_iv_ausf_j',
          },
          {
            'Name EN': 'Sd.Kfz.234/2',
            'Name RU': 'Sd.Kfz.234/2',
            'Name Game': 'germ_sdkfz_234_2',
          },
          {
            'Name EN': 'StuG III G',
            'Name RU': 'StuG III G',
            'Name Game': 'germ_stug_iii_ausf_g',
          },
          {
            'Name EN': 'Tiger E',
            'Name RU': 'Tiger E',
            'Name Game': 'germ_pzkpfw_vi_ausf_e_tiger',
          },
        ],
      },
    ],
  },
  {
    'Category EN': 'Berlin',
    'Category RU': 'Берлин',
    Campaign: [
      {
        'Category EN': 'Allies',
        'Category RU': 'Союзники',
        Side: [
          {
            'Name EN': 'IS-1',
            'Name RU': 'ИС-1',
            'Name Game': 'ussr_is_1',
          },
          {
            'Name EN': 'IS-2',
            'Name RU': 'ИС-2',
            'Name Game': 'ussr_is_2_1943',
          },
          {
            'Name EN': 'M4A2 (76) W',
            'Name RU': 'M4A2 (76) W',
            'Name Game': 'us_m4a2_76w_sherman',
          },
          {
            'Name EN': 'SU-85M',
            'Name RU': 'СУ-85М',
            'Name Game': 'ussr_su_85m',
          },
          {
            'Name EN': 'T-34-85',
            'Name RU': 'T-34-85',
            'Name Game': 'ussr_t_34_85_zis_53',
          },
          {
            'Name EN': 'T-34-85 (D-5T)',
            'Name RU': 'T-34-85 (Д-5T)',
            'Name Game': 'ussr_t_34_85_d_5t',
          },
          {
            'Name EN': 'T-34-85E',
            'Name RU': 'T-34-85E',
            'Name Game': 'ussr_t_34_85_e',
          },
        ],
      },
      {
        'Category EN': 'Axis',
        'Category RU': 'Ось',
        Side: [
          {
            'Name EN': 'Panther A',
            'Name RU': 'Panther A',
            'Name Game': 'germ_pzkpfw_v_ausf_a_panther',
          },
          {
            'Name EN': 'Panther G',
            'Name RU': 'Panther G',
            'Name Game': 'germ_pzkpfw_v_ausf_g_panther',
          },
          {
            'Name EN': 'Panzer IV/70(A)',
            'Name RU': 'Panzer IV/70(A)',
            'Name Game': 'germ_panzerjager_iv_l_70_a',
          },
          {
            'Name EN': 'Pz.IV J',
            'Name RU': 'Pz.IV J',
            'Name Game': 'germ_pzkpfw_iv_ausf_j',
          },
          {
            'Name EN': 'Tiger E',
            'Name RU': 'Tiger E',
            'Name Game': 'germ_pzkpfw_vi_ausf_e_tiger',
          },
          {
            'Name EN': 'Tiger II (P)',
            'Name RU': 'Tiger II (P)',
            'Name Game': 'germ_pzkpfw_vi_ausf_b_tiger_iip',
          },
        ],
      },
    ],
  },
  {
    'Category EN': 'Tunisia',
    'Category RU': 'Тунис',
    Campaign: [
      {
        'Category EN': 'Allies',
        'Category RU': 'Союзники',
        Side: [
          {
            'Name EN': 'A13 Mk II',
            'Name RU': 'A13 Mk II',
            'Name Game': 'uk_a13_mk_2_1938',
          },
          {
            'Name EN': 'A13 Mk II 1939',
            'Name RU': 'A13 Mk II 1939',
            'Name Game': 'uk_a13_mk_2_1939',
          },
          {
            'Name EN': 'Crusader',
            'Name RU': 'Crusader',
            'Name Game': 'uk_crusader_mk_3',
          },
          {
            'Name EN': 'Daimler Mk II',
            'Name RU': 'Daimler Mk II',
            'Name Game': 'uk_daimler_mk_2',
          },
          {
            'Name EN': 'Matilda',
            'Name RU': 'Matilda',
            'Name Game': 'ussr_matilda_iii',
          },
          {
            'Name EN': 'Mk I "Grant"',
            'Name RU': 'Mk I "Grant"',
            'Name Game': 'uk_mk_1_grant',
          },
          {
            'Name EN': 'Sherman II',
            'Name RU': 'Sherman II',
            'Name Game': 'uk_sherman_ii',
          },
        ],
      },
      {
        'Category EN': 'Axis',
        'Category RU': 'Ось',
        Side: [
          {
            'Name EN': '75/32 M41',
            'Name RU': '75/32 M41',
            'Name Game': 'it_m41_75_32',
          },
          {
            'Name EN': 'AB 41',
            'Name RU': 'AB 41',
            'Name Game': 'it_ab_41',
          },
          {
            'Name EN': 'M13/40 (III)',
            'Name RU': 'M13/40 (III)',
            'Name Game': 'it_m13_40_serie_3',
          },
          {
            'Name EN': 'M14/41',
            'Name RU': 'M14/41',
            'Name Game': 'it_m14_41',
          },
          {
            'Name EN': 'Pz.III J',
            'Name RU': 'Pz.III J',
            'Name Game': 'germ_pzkpfw_iii_ausf_j_l42',
          },
          {
            'Name EN': 'Pz.III N',
            'Name RU': 'Pz.III N',
            'Name Game': 'germ_pzkpfw_iii_ausf_n',
          },
          {
            'Name EN': 'Pz.IV F2',
            'Name RU': 'Pz.IV F2',
            'Name Game': 'germ_pzkpfw_iv_ausf_f2',
          },
        ],
      },
    ],
  },
  {
    'Category EN': 'Stalingrad',
    'Category RU': 'Сталинград',
    Campaign: [
      {
        'Category EN': 'Allies',
        'Category RU': 'Союзники',
        Side: [
          {
            'Name EN': 'HT-130',
            'Name RU': 'ХТ-130',
            'Name Game': 'ussr_ht_130',
          },
          {
            'Name EN': 'KV-1 (L-11)',
            'Name RU': 'КВ-1 (Л-11)',
            'Name Game': 'ussr_kv_1_l_11',
          },
          {
            'Name EN': 'T-34',
            'Name RU': 'T-34',
            'Name Game': 'ussr_t_34_1940_l_11',
          },
          {
            'Name EN': 'T-34 (1941)',
            'Name RU': 'T-34 (1941)',
            'Name Game': 'ussr_t_34_1941',
          },
          {
            'Name EN': 'T-34E "STZ"',
            'Name RU': 'Т-34Э "СТЗ"',
            'Name Game': 'ussr_t_34e_stz',
          },
          {
            'Name EN': 'T-70',
            'Name RU': 'T-70',
            'Name Game': 'ussr_t_70',
          },
        ],
      },
      {
        'Category EN': 'Axis',
        'Category RU': 'Ось',
        Side: [
          {
            'Name EN': 'Pz.II (F)',
            'Name RU': 'Pz.II (F)',
            'Name Game': 'germ_pzkpfw_ii_flamm',
          },
          {
            'Name EN': 'Pz.III J',
            'Name RU': 'Pz.III J',
            'Name Game': 'germ_pzkpfw_iii_ausf_j_l42',
          },
          {
            'Name EN': 'Pz.III N',
            'Name RU': 'Pz.III N',
            'Name Game': 'germ_pzkpfw_iii_ausf_n',
          },
          {
            'Name EN': 'Pz.IV F2',
            'Name RU': 'Pz.IV F2',
            'Name Game': 'germ_pzkpfw_iv_ausf_f2',
          },
          {
            'Name EN': 'Pz.IV G',
            'Name RU': 'Pz.IV G',
            'Name Game': 'germ_pzkpfw_iv_ausf_g',
          },
          {
            'Name EN': 'StuG III F',
            'Name RU': 'StuG III F',
            'Name Game': 'germ_stug_iii_ausf_f',
          },
        ],
      },
    ],
  },
];

const STARUPGRADES = {
  assault_rifle: [
    {},
    { dev: 0.85 },
    { recoilVert: 0.85, recoilHoriz: 0.85 },
    { damage: 1.10, dev: 0.85 },
  ],
};

const DAMAGES = {
  ' 10m1 50m0.83 100m0.67 200m0.4': {
    a: 10.74505,
    b: 0.7342634,
    c: 309204400,
    d: -236238.6,
  },
};

function getAmmoProperty(ammo, property) {
  if (Array.isArray(ammo)) {
    for (let i = 0; i < ammo.length; i++) {
      if (Object.keys(ammo[i])[0] === property) {
        return ammo[i][property];
      }
    }
  } else {
    return ammo[property];
  }
  return null;
}

function getDataPropertyWithOverrides(gun, property) {
  // first check overrides
  if (OVERRIDEGUNSDATA[gun[0]] != null) {
    if (OVERRIDEGUNSDATA[gun[0]][property] != null) {
      return OVERRIDEGUNSDATA[gun[0]][property];
    }
    if (OVERRIDEGUNSDATA[gun[0]]._extends != null) {
      // prioritize searching stalingrad files, since this only happens if we're looking for them
      if (OVERRIDEGUNSDATA[gun[0]]._extends.startsWith('stl_')) {
        gun.unshift(OVERRIDEGUNSDATA[gun[0]]._extends);
      } else {
        gun.push(OVERRIDEGUNSDATA[gun[0]]._extends);
      }
    }
  }
  // then check base file
  if (ALLGUNSDATA[gun[0]] != null) {
    if (ALLGUNSDATA[gun[0]][property] != null) {
      return ALLGUNSDATA[gun[0]][property];
    }
    if (ALLGUNSDATA[gun[0]]._extends != null) {
      if (ALLGUNSDATA[gun[0]]._extends.startsWith('stl_')) {
        gun.splice(1, 0, ALLGUNSDATA[gun[0]]._extends);
      } else {
        gun.push(ALLGUNSDATA[gun[0]]._extends);
      }
    }
    for (let k = 0; k < ALLGUNSDATA[gun[0]].length; k++) {
      if (Object.prototype.hasOwnProperty.call(ALLGUNSDATA[gun[0]][k], property)) {
        return ALLGUNSDATA[gun[0]][k][property];
      }
      if (Object.prototype.hasOwnProperty.call(ALLGUNSDATA[gun[0]][k], '_extends')) {
        if (ALLGUNSDATA[gun[0]][k]._extends.startsWith('stl_')) {
          gun.splice(1, 0, ALLGUNSDATA[gun[0]][k]._extends);
        } else {
          gun.push(ALLGUNSDATA[gun[0]][k]._extends);
        }
      }
    }
  }
  // not found here, recurse with extensions
  if (gun.length > 0) {
    gun.shift();
    return getDataPropertyWithOverrides(gun, property);
  }
  // not found at all
  return '-';
}

function getDataProperty(gun, property) {
  // Stalingrad does weird things to guns
  if (gun[0].startsWith('stl_')) {
    // for rpm return post-nerf rpm
    if (property === 'gun__shotFreq') {
      // except for zh-29, which has pre-nerf
      if (gun[0] === 'stl_zh_29_gun') {
        return getDataPropertyWithoutOverrides(gun, property);
      }
      // except for kar98k, which uses its parent gun's fire rate
      if (gun[0] === 'stl_kar98k_wartime_production_gun') {
        gun[0] = gun[0].replace('stl_', '');
      }
      return getDataPropertyWithOverrides(gun, property);
    }
    // for dispersion, return pre-nerf dispersion
    if (property === 'gun_spread__maxDeltaAngle') {
      return getDataPropertyWithoutOverrides(gun, property);
    }
  }
  return getDataPropertyWithOverrides(gun, property);
}
