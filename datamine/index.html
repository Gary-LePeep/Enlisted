<!DOCTYPE html>
<html>

<head>

<body style="background-color:rgb(107, 133, 133);"></body>
<title>
    Enlisted weapon comparison tool
</title>

<script type="text/javascript" src="../weapon-data.js"></script>
<script type="text/javascript" src="../translations.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../dist/chart.min.js"></script>
<script src="../dist/chartjs-plugin-annotation.min.js"></script>


<script>
    function loadJSON(callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', './ww2_guns.blkx', true);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                callback(JSON.parse(xobj.responseText));
            }
        };
        xobj.send(null);
    }

    // Create new css link Element
    var css = document.createElement('link');
    css.rel = 'stylesheet';
    css.type = 'text/css';
    css.href = '../style.css';
    document.getElementsByTagName('HEAD')[0].appendChild(css);
</script>
</head>

<body>

    <select id="language_dropdown" onchange="window.location.reload();" style="position:absolute; top:20px; left:90%;">
        <option> English </option>
        <option> Русский </option>
    </select>


    <script>
        var title = translate("datamine", "div");
        title.className = "TITLE";
        document.getElementsByTagName('BODY')[0].appendChild(title);

        title.appendChild(translate("language", "b", "position:absolute; top:20px; left:85%; font-size:16px"));
    </script>


    <script>
        // Color Dropdown
        var headerbox = document.createElement('header');
        headerbox.id = "header-box";
        document.getElementsByTagName('BODY')[0].appendChild(headerbox);

        var header = document.createElement('div');
        header.className = "header";
        headerbox.append(header);

        var primary = document.createElement("nav");
        header.append(primary);

        var primarylist = document.createElement("ul");
        primary.append(primarylist)
        var colorButtonContainer = document.createElement("li");
        primarylist.append(colorButtonContainer);

        var colorButton = document.createElement("li");
        colorButton.className = "link topbtn greenbtn";
        colorButtonContainer.append(colorButton);

        var colorButtonText = document.createElement("a");
        colorButtonText.style = "color: white";
        colorButtonText.text = translate("Weapon");
        colorButton.append(colorButtonText);

        var categorylist = document.createElement("ul");
        colorButton.append(categorylist)

        /* Data */
        // Name
        var dataDiv = document.createElement("div");
        dataDiv.style = "position: relative; left: 30%";
        document.getElementsByTagName('BODY')[0].appendChild(dataDiv)

        var gunName = translate("gunName", "div");
        dataDiv.append(gunName);
        var gunNameData = document.createElement("b");
        gunNameData.textContent = "-";
        gunName.append(gunNameData);

        var gunIGN = translate("gunIGN", "div");
        dataDiv.append(gunIGN);
        var gunIGNData = document.createElement("b");
        gunIGNData.textContent = "-";
        gunIGN.append(gunIGNData);

        dataDiv.append(document.createElement("div"));

        var rpm = translate("rpm", "div");
        dataDiv.append(rpm);
        var rpmData = document.createElement("b");
        rpmData.textContent = "-";
        rpm.append(rpmData);



        for (var i = -1; i < WEAPONS.length; i++) (function (i) {
            var categoryButton = document.createElement("li");
            categoryButton.className = "Link submenu";
            categorylist.append(categoryButton);

            var categoryButtonText = document.createElement("a");
            categoryButtonText.text = i < 0 ? translate("Remove") : WEAPONS[i][translate("Category")];
            categoryButton.append(categoryButtonText);

            categoryButton.onclick = function () {
                if (categoryButtonText.text == translate("Remove")) {
                    // reset color button
                    colorButtonText.text = translate("Weapon");
                    gunNameData.textContent = "-";
                    gunIGNData.textContent = "-";
                    rpmData.textContent = "-";
                }
            }

            var weaponlist = document.createElement("ul");
            categoryButton.append(weaponlist)

            for (var j = 0; i >= 0 && j < WEAPONS[i].Weapons.length; j++) (function (j) {
                var weaponButton = document.createElement("li");
                weaponButton.className = "link submenu";
                weaponlist.append(weaponButton);

                var weaponButtonText = document.createElement("a");
                weaponButtonText.text = WEAPONS[i].Weapons[j][translate("WepName")];
                weaponButton.append(weaponButtonText);
                weaponButton.tagName = weaponButtonText.text;

                weaponButton.onclick = function () {
                    // set color button name to selected weapon
                    colorButtonText.text = weaponButtonText.text

                    var allData;
                    loadJSON(function (json) {
                        allData = json;
                    });
                    console.log(allData);

                    gunNameData.textContent = WEAPONS[i].Weapons[j][translate("WepName")];
                    gunIGNData.textContent = WEAPONS[i].Weapons[j]["Name Game"];
                    for (data in allData[gunIGNData.textContent]) {
                        if (data.hasOwnProperty("gun__shotFreq")) {
                            rpmData.textContent = Math.round(data["gun__shotFreq"] * 60);
                        }
                    }
                }
            })(j)
        })(i)

        function weaponByName(name) {
            for (var i = 0; i < WEAPONS.length; i++) {
                for (var j = 0; j < WEAPONS[i].Weapons.length; j++) {
                    if (WEAPONS[i].Weapons[j][translate("WepName")] == name) {
                        return WEAPONS[i].Weapons[j];
                    }
                }
            }
        }
    </script>

    <script>
        document.getElementsByTagName('BODY')[0].appendChild(translate("contact", 'p', "color: #002244; position: absolute; top: 95%; left: 40%"));
    </script>
</body>

</html>